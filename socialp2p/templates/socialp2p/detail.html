{% extends 'base.html' %}
{% load staticfiles %}
{% load cloudinary %}
{% block body %}
{% load tz %}
<div class="container" id="container">
    <p>username: {{user_profile.displayname}}</p>
    <p>id: {{user_profile.id}}</p>
    <p>host: {{user_profile.host}}</p>
    <p>url: {{user_profile.url}}</p>
    {% cloudinary user_profile.author.photo %}
    {% if not is_friend %}
        <form action="{% url 'api:friend_request' %}" method="POST" id="add">
            {% csrf_token %}
            <input type="submit" value="Add Friend" />
        </form>
	{% for post in posts %}
    	{% if user.author.uuid == post.author.uuid %}
	{{user.username}}
    	<div class="posts">
        	<div class="profile">
            		<a href="{% url 'socialp2p:profile' post.author.uuid%}">{% cloudinary post.author.photo %}</a>
            		<a href="{% url 'socialp2p:profile' post.author.uuid%}"><strong class="displayname">{{ post.author.displayname }}</strong></a>
            	<span class="time">{{ post.datetime|localtime }}</span>
        	</div>
        	<div class=content>
            		<p>{{ post.content }}</p>
            		{% if post.image %}
            		{% cloudinary post.image width=700 height=300 crop="fill" %}
            		{% endif %}
        	</div>
    	</div>
	{% endif %}
	{% endfor %}
	<script type='text/javascript'>
    	    $("#add").submit(function(event) {

      	        event.preventDefault();
   		var user_uuid = "{{user.author.uuid}}"
		var author_uuid = "{{user_profile.id}}"
		var author_host = "{{user_profile.host}}"
		var author_displayname = "{{user_profile.displayname}}"

      	        var $form = $( this ),
                    url = $form.attr( 'action' ); 	       
      	        $.ajax({
		    type:"POST", 
		    url,
		    data : {csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value, author : JSON.stringify(user_uuid), friend : JSON.stringify(author_uuid), host : JSON.stringify(author_host), displayname : author_displayname},
    		    dataType : "json",
		    success: function( data ){
           	        alert("Added Friend");
    		    } 
	  	});
    	     });
	</script>
    {% endif %}
</div>
{% endblock %}
